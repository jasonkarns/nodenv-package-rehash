#!/usr/bin/env bash

set -e
[ -n "$NODENV_DEBUG" ] && set -x

NODE_DIR="$(nodenv-prefix "$1")"
NPM_HOOKS_DIR="$NODE_DIR/lib/node_modules/.hooks"

echo "INSTALLING HOOK SCRIPTS to $NPM_HOOKS_DIR"

mkdir -p "$NPM_HOOKS_DIR"

# install the postinstall/postuninstall hook scripts by symlinking them
PLUGIN_ROOT="${BASH_SOURCE%/*}/../"
REHASH="$PLUGIN_ROOT/libexec/nodenv-rehash.sh"
POSTINSTALL_HOOK="$NPM_HOOKS_DIR/postinstall"
POSTUNINSTALL_HOOK="$NPM_HOOKS_DIR/postuninstall"

ln -nsf "$REHASH" "$POSTINSTALL_HOOK"
ln -nsf "$REHASH" "$POSTUNINSTALL_HOOK"
